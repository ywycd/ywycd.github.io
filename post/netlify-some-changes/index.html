<!doctype html><html lang=en><head><meta charset=utf-8><meta name=referrer content="same-origin"><title>托管在Netlify的博客更改记录 :: ywy — 有约不来过夜半，闲敲棋子落灯花</title><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="切换Git分支 切换为 main 两边博客分支不同，看灯大博客可以修改分支，开始操作。 git checkout master git branch -m main # 删除本地分支 git branch -d master # 删除远程分支 git push origin --delete master # （并"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://ywycd.github.io/post/netlify-some-changes/><link rel=stylesheet href=https://ywycd.github.io/assets/style.min.css?d41d8cd98f00b204e9800998ecf8427e><link rel=apple-touch-icon-precomposed sizes=144x144 href=https://ywycd.github.io/img/favicon/apple-icon-precomposed.png><link rel="shortcut icon" href=https://ywycd.github.io/img/apple-touch-icon-rm.png><meta name=twitter:card content="summary"><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="托管在Netlify的博客更改记录 :: ywy"><meta property="og:description" content="切换Git分支 切换为 main 两边博客分支不同，看灯大博客可以修改分支，开始操作。 git checkout master git branch -m main # 删除本地分支 git branch -d master # 删除远程分支 git push origin --delete master # （并"><meta property="og:url" content="https://ywycd.github.io/post/netlify-some-changes/"><meta property="og:site_name" content="ywy"><meta property="og:image" content="https://ywycd.github.io/img/apple-touch-icon-rm.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2021-03-28 10:55:31 +0800 +0800"></head><body><div class="container center headings--one-size"><header class=header style=background-image:url(/img/banner-rain-731313_1920.png);background-position:50%;background-repeat:no-repeat;background-size:cover><div class=header__inner><div class=header__logo><a href=https://ywycd.github.io/><div class=logo>ASDW</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about>About</a></li><li><a href=/archive>Archive</a></li><li><a href=/tagcloud>TagCloud</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about>About</a></li><li><a href=/archive>Archive</a></li><li><a href=/tagcloud>TagCloud</a></li></ul></nav><div class=feed-links></div></header><div class=content><div class=post><h1 class=post-title>托管在Netlify的博客更改记录</h1><div class=post-meta><span class=post-date>2021-03-28</span>
<span class=post-author>::
ywy</span>
:: Mod 2021-03-28(39acbf3)</div><span class=post-tags>#<a href=https://ywycd.github.io/tags/github/>github</a>&nbsp;
#<a href=https://ywycd.github.io/tags/netlify/>netlify</a>&nbsp;
#<a href=https://ywycd.github.io/tags/hugo/>hugo</a>&nbsp;</span><div class=post-content><div><h2 id=切换git分支>切换Git分支<a href=#切换git分支 class=hanchor arialabel=Anchor>&#8983;</a></h2><h3 id=切换为-main>切换为 main<a href=#切换为-main class=hanchor arialabel=Anchor>&#8983;</a></h3><p>两边博客分支不同，看灯大博客可以修改分支，开始操作。</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>git checkout master

git branch -m main

<span class=c1># 删除本地分支</span>
git branch -d master

<span class=c1># 删除远程分支</span>
git push origin --delete master

<span class=c1># （并不是真正想push, 只是隐式地将远程分支设置为了跟踪main)</span>
git push origin -u main

</code></pre></div><h3 id=网站配置>网站配置<a href=#网站配置 class=hanchor arialabel=Anchor>&#8983;</a></h3><p>在 Github repo 设置 -> Branches 里, 将默认分支设置为 main。</p><p>Netlify Build 设置里将默认分支设置成 main。</p><h2 id=集成-netlify-cms>集成 Netlify CMS<a href=#集成-netlify-cms class=hanchor arialabel=Anchor>&#8983;</a></h2><h3 id=相关介绍>相关介绍<a href=#相关介绍 class=hanchor arialabel=Anchor>&#8983;</a></h3><p>Netlify CMS 主要是解决了，随时随地打开浏览器写markdown博客的问题，同时它自动处理了图片上传等问题。编辑器可以在富文本（所见即所得）和 Markdown 方式之间切换，Markdown模式没有语法高亮显示。</p><blockquote><p>Netlify CMS = web 版的 markdown 文件管理器 + 自动图片上传并插入markdown代码 + 在web浏览器写markdown并自动推送到git仓库构建 ….</p></blockquote><h3 id=部署方法>部署方法<a href=#部署方法 class=hanchor arialabel=Anchor>&#8983;</a></h3><p>在<code>static</code> 目录下新建<code>admin</code>目录，里面放一个<code>index.html</code> 文件作为后台管理的入口。
<code>static/admin/index.html</code> 内容如下：</p><div class=highlight><pre class=chroma><code class=language-html data-lang=html><span class=cp>&lt;!doctype html&gt;</span>
<span class=p>&lt;</span><span class=nt>html</span><span class=p>&gt;</span>
<span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
  <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>charset</span><span class=o>=</span><span class=s>&#34;utf-8&#34;</span> <span class=p>/&gt;</span>
  <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;viewport&#34;</span> <span class=na>content</span><span class=o>=</span><span class=s>&#34;width=device-width, initial-scale=1.0&#34;</span> <span class=p>/&gt;</span>
  <span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span>Blog Manager<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
  <span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://identity.netlify.com/v1/netlify-identity-widget.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
<span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
<span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
  <span class=c>&lt;!-- Include the script that builds the page and powers Netlify CMS --&gt;</span>
  <span class=c>&lt;!-- https://www.jsdelivr.com/package/npm/netlify-cms --&gt;</span>
  <span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://cdn.jsdelivr.net/npm/netlify-cms@2.10.96/dist/netlify-cms.min.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>

<span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
<span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</code></pre></div><p><code>static/admin/config.yml</code> 内容如下：</p><div class=highlight><pre class=chroma><code class=language-yml data-lang=yml><span class=c># https://www.netlifycms.org/docs/add-to-your-site/</span><span class=w>
</span><span class=w></span><span class=nt>backend</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>git-gateway</span><span class=w>
</span><span class=w>  </span><span class=nt>branch</span><span class=p>:</span><span class=w> </span><span class=l>main</span><span class=w> </span><span class=c># Branch to update (optional; defaults to master)</span><span class=w>
</span><span class=w>  </span><span class=nt>squash_merges</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w> </span><span class=c># beta feature</span><span class=w>
</span><span class=w>
</span><span class=w> </span><span class=c># when using the default proxy server port</span><span class=w>
</span><span class=w> </span><span class=c># Run npx netlify-cms-proxy-server from the root dir of the repo</span><span class=w>
</span><span class=w></span><span class=nt>local_backend</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=c># 编辑工作流程</span><span class=w>
</span><span class=w></span><span class=nt>publish_mode</span><span class=p>:</span><span class=w> </span><span class=l>editorial_workflow</span><span class=w>
</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=c># 全局静态文件上传目录</span><span class=w>
</span><span class=w></span><span class=nt>media_folder</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;static/img/uploads&#34;</span><span class=w> </span><span class=c># Media files will be stored in the repo under images/uploads</span><span class=w>
</span><span class=w></span><span class=nt>public_folder</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/img/uploads&#34;</span><span class=w> </span><span class=c># The src attribute for uploaded media will begin with /images/uploads</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=nt>media_folder_relative</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=nt>collections</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;post&#34;</span><span class=w> </span><span class=c># Used in routes, e.g., /admin/collections/blog</span><span class=w>
</span><span class=w>    </span><span class=nt>label</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Post&#34;</span><span class=w> </span><span class=c># Used in the UI</span><span class=w>
</span><span class=w>    </span><span class=nt>folder</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;content/post&#34;</span><span class=w> </span><span class=c># The path to the folder where the documents are stored</span><span class=w>
</span><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;{{slug}}/index&#39;</span><span class=w> </span><span class=c># beta feature</span><span class=w>
</span><span class=w>    </span><span class=nt>media_folder</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w>
</span><span class=w>    </span><span class=nt>public_folder</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w>
</span><span class=w>    </span><span class=c># adding a nested object will show the collection folder structure</span><span class=w>
</span><span class=w>    </span><span class=nt>nested</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>depth</span><span class=p>:</span><span class=w> </span><span class=m>100</span><span class=w> </span><span class=c># max depth to show in the collection tree</span><span class=w>
</span><span class=w>      </span><span class=nt>summary</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;{{title}}&#39;</span><span class=w> </span><span class=c># optional summary for a tree node, defaults to the inferred title field</span><span class=w>
</span><span class=w>    </span><span class=c># adding a meta object with a path property allows editing the path of entries</span><span class=w>
</span><span class=w>    </span><span class=c># moving an existing entry will move the entire sub tree of the entry to the new location</span><span class=w>
</span><span class=w>    </span><span class=nt>meta</span><span class=p>:</span><span class=w> </span>{<span class=w> </span><span class=nt>path</span><span class=p>:</span><span class=w> </span>{<span class=w> </span><span class=nt>widget: string, label: &#39;Path&#39;, index_file: &#39;index&#39;, hint</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;markdown文件路径, 对于page bundle, 如 &#34;一级目录/二级目录/page-bundle目录/index.md&#34;, 只需要填写 &#34;一级目录/二级目录/page-bundle目录&#34;,不
</span><span class=s1>要忘记填写page-bundle目录&#39;</span><span class=w> </span>}<span class=w> </span>}<span class=w>
</span><span class=w>    </span><span class=nt>create</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w> </span><span class=c># Allow users to create new documents in this collection</span><span class=w>
</span><span class=w>    </span><span class=nt>slug</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{year}}-{{month}}-{{day}}-{{slug}}&#34;</span><span class=w> </span><span class=c># Filename template, e.g., YYYY-MM-DD-title.md</span><span class=w>
</span><span class=w>    </span><span class=nt>fields</span><span class=p>:</span><span class=w> </span><span class=c># The fields for each document, usually in front matter</span><span class=w>
</span><span class=w>      </span>- {<span class=nt>label</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Title&#34;</span><span class=nt>, name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;title&#34;</span><span class=nt>, widget</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;string&#34;</span><span class=nt>, hint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;文章标题&#34;</span>}<span class=w>
</span><span class=w>      </span>- {<span class=nt>label</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Slug&#34;</span><span class=nt>, name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;slug&#34;</span><span class=nt>, widget</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;string&#34;</span><span class=nt>, required: false, hint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Slug可以是目录,如 linux/archlinux, 此项会作为路径的功能可能会被 path meta 覆盖&#34;</span>}<span class=w>
</span><span class=w>      </span>- {<span class=nt>label</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Draft&#34;</span><span class=nt>, name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;draft&#34;</span><span class=nt>, widget</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;boolean&#34;</span><span class=nt>, default: true, hint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;草稿不会 build&#34;</span>}<span class=w>
</span><span class=w>      </span>- {<span class=nt>label</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Publish Date&#34;</span><span class=nt>, name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;date&#34;</span><span class=nt>, widget</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;datetime&#34;</span>}<span class=w>
</span><span class=w>      </span>- {<span class=nt>label</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Tags&#34;</span><span class=nt>, name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;tags&#34;</span><span class=nt>, widget</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;list&#34;</span><span class=nt>, required</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;文章标签，用半角逗号分隔&#34;</span>}<span class=w>
</span><span class=w>      </span>- {<span class=nt>label</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Body&#34;</span><span class=nt>, name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;body&#34;</span><span class=nt>, widget</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;markdown&#34;</span><span class=nt>, hint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;博客正文&#34;</span>}<span class=w>
</span></code></pre></div><h3 id=本地git仓库模式>本地Git仓库模式<a href=#本地git仓库模式 class=hanchor arialabel=Anchor>&#8983;</a></h3><p>简单启用，只需要在 <code>config.yml</code> 中添加 <code>local_backend: true</code> 即可。 然后 <code>npx netlify-cms-proxy-server</code> 启动 proxy 即可，它默认监听 8081 端口。 然后通过 hugo serve 启动，然后访问 <code>http://localhost:1313/admin/ </code>即可。</p><h3 id=启用cms>启用CMS<a href=#启用cms class=hanchor arialabel=Anchor>&#8983;</a></h3><p>上面文件创建后，推送到git。点开<code>https://xxx.netlify.app/admin/</code>提示没有<code>Git Gateway</code>。
<a href=https://docs.netlify.com/visitor-access/git-gateway/#setup-and-settings>启用git-gateway</a> 介绍，进netlify网页Site settings > Identity, 先<code>enable Identity service</code>。Identity > Services > Git Gateway, 选择<code>Enable Git Gateway</code>，同时生成token。
<a class=post-img-lb href=https://i.endpot.com/image/BXLGV/snipaste_20210328_135751.png data-caption=snipaste_20210328_135751.png><img src=https://i.endpot.com/image/BXLGV/snipaste_20210328_135751.png alt=snipaste_20210328_135751.png></a>
再访问<code>https://xxx.netlify.app/admin/</code>注册账号，点击邮箱验证身份(博客地址加token)。但后面登陆时提示未激活。查阅
<a href=https://docs.netlify.com/visitor-access/identity/registration-login/#add-identity-users>注册</a> 后在External providers里选了github，授权登陆成功。后面测试邮箱可登陆，再不行可设置无验证。
<a class=post-img-lb href=https://i.endpot.com/image/VCV0O/snipaste_20210328_140555.png data-caption=snipaste_20210328_140555.png><img src=https://i.endpot.com/image/VCV0O/snipaste_20210328_140555.png alt=snipaste_20210328_140555.png></a>
<a class=post-img-lb href=https://i.endpot.com/image/AT1KL/snipaste_20210328_140747.png data-caption=snipaste_20210328_140747.png><img src=https://i.endpot.com/image/AT1KL/snipaste_20210328_140747.png alt=snipaste_20210328_140747.png></a>
这里可查看注册账号，在Roles里可设置管理员权限。
<a class=post-img-lb href=https://i.endpot.com/image/JGXWC/snipaste_20210328_141150.png data-caption=snipaste_20210328_141150.png><img src=https://i.endpot.com/image/JGXWC/snipaste_20210328_141150.png alt=snipaste_20210328_141150.png></a>
改为邀请注册，免费只能邀请5人。开放注册1000人，算活跃人数。</p><p><del>使用CMS编辑文章，打字经常字符消失，打不完一整句，切换模式也这样。编辑好保存，是pull requests到仓库，tags格式改变。还是电脑码字发布吧。</del></p></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button next"><a href=https://ywycd.github.io/post/termux-note/><span class=button__text>Termux笔记</span>
<span class=button__icon>→</span></a></span></div></div></div><div class=post-toc id=post-toc><h2 class=post-toc-title></h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><a href=#切换git分支>切换Git分支</a><ul><li><a href=#切换为-main>切换为 main</a></li><li><a href=#网站配置>网站配置</a></li></ul></li><li><a href=#集成-netlify-cms>集成 Netlify CMS</a><ul><li><a href=#相关介绍>相关介绍</a></li><li><a href=#部署方法>部署方法</a></li><li><a href=#本地git仓库模式>本地Git仓库模式</a></li><li><a href=#启用cms>启用CMS</a></li></ul></li></ul></nav></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>:: Powered by <a href=http://gohugo.io>Hugo</a> 0.82.0</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><a id=back-to-top style=display:inline-block href=javascript:void(0); onclick="window.scrollTo({top:0,behavior:'smooth'})"><span class="iconfont icon-top"></span></a><script src=https://ywycd.github.io/assets/main.js?d41d8cd98f00b204e9800998ecf8427e></script><script>const addCopyButtons=function(a){document.querySelectorAll('pre > code').forEach(function(d){const b=document.createElement('button');b.className='copy-code-button',b.type='button',b.innerText='Copy';const c=document.createElement('div');c.className='copy-code-button-wrap',c.appendChild(b),b.addEventListener('click',function(){a.writeText(d.innerText).then(function(){b.blur(),b.innerText='Done!',setTimeout(function(){b.innerText='Copy'},2e3)},function(a){b.innerText='Error'})});const e=d.parentNode;e.insertAdjacentElement('beforebegin',c)})};window.addEventListener('load',function(b){const a=document.links;for(let b=0,c=a.length;b<c;b++)a[b].hostname!=window.location.hostname&&!a[b].href.startsWith('javascript:')&&!a[b].href.startsWith('mailto:')&&(a[b].target='_blank');document.querySelectorAll('#TableOfContents li').length>0&&(document.querySelector('#post-toc').style.display='block'),document.querySelectorAll('#post-toc a').forEach(a=>{a.addEventListener('click',a=>{document.querySelectorAll('#post-toc a').forEach(a=>{a.classList.remove('active')}),a.target.classList.add('active')})}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener('click',function(a){a.preventDefault(),document.getElementById(this.getAttribute('href').substring(1)).scrollIntoView({behavior:'smooth'})})}),navigator&&navigator.clipboard&&addCopyButtons(navigator.clipboard)})</script></div></body></html>